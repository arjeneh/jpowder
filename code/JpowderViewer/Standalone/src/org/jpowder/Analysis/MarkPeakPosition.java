/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * Peack.java
 *
 * Created on 26-Nov-2009, 11:32:11
 */

package org.jpowder.Analysis;

import java.awt.BasicStroke;
import java.awt.Color;
import java.util.List;
import java.util.Vector;
import org.jfree.chart.plot.Marker;
import org.jfree.chart.plot.ValueMarker;
import org.jfree.chart.plot.XYPlot;
import org.jfree.data.xy.XYDataset;
import org.jfree.ui.LengthAdjustmentType;
import org.jfree.ui.RectangleAnchor;
import org.jfree.ui.TextAnchor;
import org.jpowder.util.VectorMiscUtil;


/**
 *
 * @author qyt21516
 */
public class MarkPeakPosition extends javax.swing.JPanel {

    private XYPlot plot;
    /** Creates new form Peack */
    public MarkPeakPosition() {
        initComponents();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTextArea1 = new javax.swing.JTextArea();
        Back = new javax.swing.JButton();
        jCheckBox1 = new javax.swing.JCheckBox();

        setPreferredSize(new java.awt.Dimension(274, 362));

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 11));
        jLabel1.setText("Mark The Peak Position");

        jScrollPane1.setViewportBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(240, 240, 240)));

        jTextArea1.setBackground(new java.awt.Color(236, 233, 216));
        jTextArea1.setColumns(20);
        jTextArea1.setEditable(false);
        jTextArea1.setLineWrap(true);
        jTextArea1.setRows(5);
        jTextArea1.setText("Click on the Check Box to change the plotted data in the frame which is in focus.This is also avaliable when you right click on the frame.   ");
        jTextArea1.setWrapStyleWord(true);
        jTextArea1.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(240, 240, 240), 1, true));
        jTextArea1.setOpaque(false);
        jScrollPane1.setViewportView(jTextArea1);

        Back.setText("Back");
        Back.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BackActionPerformed(evt);
            }
        });

        jCheckBox1.setText("Get Peak Position");
        jCheckBox1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBox1ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap(112, Short.MAX_VALUE)
                .addComponent(jLabel1)
                .addGap(30, 30, 30))
            .addComponent(jSeparator1, javax.swing.GroupLayout.DEFAULT_SIZE, 274, Short.MAX_VALUE)
            .addGroup(layout.createSequentialGroup()
                .addGap(97, 97, 97)
                .addComponent(Back)
                .addContainerGap(122, Short.MAX_VALUE))
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 254, Short.MAX_VALUE)
                    .addComponent(jCheckBox1, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(35, 35, 35)
                .addComponent(jLabel1)
                .addGap(27, 27, 27)
                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(51, 51, 51)
                .addComponent(jCheckBox1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 28, Short.MAX_VALUE)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 110, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(26, 26, 26)
                .addComponent(Back)
                .addGap(23, 23, 23))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void BackActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BackActionPerformed

    }//GEN-LAST:event_BackActionPerformed

    private void jCheckBox1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBox1ActionPerformed
 XYDataset dataset = getPlot().getDataset();

        List chartList = new Vector();
        Vector tX = new Vector();
        Vector tY = new Vector();

        //Multiple series in case of series in a chart.
        int seriescount = getPlot().getSeriesCount();
        for (int seriesindex = 0; seriesindex < seriescount; seriesindex++) {

          for (int itemindex = 0; itemindex < dataset.getItemCount(seriesindex); itemindex++) {
            tX.add(dataset.getXValue(seriesindex, itemindex));
            tY.add(dataset.getYValue(seriesindex, itemindex));
          }
          chartList.add(tX);
          chartList.add(tY);
        }
        //DRAW a Y line on the max value in Range.
        //Find the max value and find its position using v.indexOf("max value");
        //Find the x position of the X axis (Domain).
        Double maxRange = VectorMiscUtil.findMaxElementOf1DVector(tY);
        //System.out.println("Max Range value is " + maxRange);
        int pos = tY.indexOf(Double.parseDouble(maxRange.toString()));//not found
        //System.out.println("Max Range position is " + pos);
        //add Marker Higlight for the range.
        Marker peakRangeMarker = new ValueMarker(Double.parseDouble(
                maxRange.toString()));

        peakRangeMarker.setStroke(new BasicStroke(1.4f));
        peakRangeMarker.setPaint(Color.yellow);
        peakRangeMarker.setLabel("Peak Range");
        peakRangeMarker.setLabelAnchor(RectangleAnchor.TOP_LEFT);
        peakRangeMarker.setLabelTextAnchor(TextAnchor.TOP_RIGHT);
        getPlot().addRangeMarker(peakRangeMarker);

        //System.out.println("tX.elementAt(pos) = " + tY.elementAt(pos));

        Double maxDomain = (Double) tX.elementAt(pos);

        Marker maxDomainTarget = new ValueMarker(maxDomain);
        maxDomainTarget.setStroke(new BasicStroke(1.4f));
        maxDomainTarget.setPaint(Color.yellow);
        maxDomainTarget.setLabelOffsetType(LengthAdjustmentType.EXPAND);
        maxDomainTarget.setLabel("Peak Domain");
        maxDomainTarget.setLabelAnchor(RectangleAnchor.TOP_RIGHT);
        maxDomainTarget.setLabelTextAnchor(TextAnchor.BOTTOM_RIGHT);
        getPlot().addDomainMarker(maxDomainTarget);
}//GEN-LAST:event_jCheckBox1ActionPerformed
   public org.jfree.chart.plot.XYPlot getPlot() {
    return plot;
  }

    /**
    * @param args the command line arguments
    */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {

                new MarkPeakPosition().setVisible(true);


            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton Back;
    private javax.swing.JCheckBox jCheckBox1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JTextArea jTextArea1;
    // End of variables declaration//GEN-END:variables

}
